/*! MMCQ.js (C) 2014 Nikola Klaric. MIT @license: opensource.org/licenses/mit-license.php */
var MMCQ=function(r){function n(r,n){return r.c()-n.c()}function o(r,n){return r.c()*r.v()-n.c()*n.v()}function f(r){var n=[],o=0;return{u:function(r){n.push(r),o=0},o:function(){return o||(n.sort(r),o=1),n.pop()},s:function(){return n.length},m:function(r){return n.map(r)}}}function t(r,n,o,f,t,u,e){var i=this;i.r1=r,i.r2=n,i.g1=o,i.g2=f,i.b1=t,i.b2=u,i.h=e}function u(r,n){for(var o,f,u,e,g,b,h,s,v,l,p,m,w,M,C,A,V,x,Q,S,d,k,q,y,z,j,B,D,E,F,G,H=1,I=0;1e3>I;)if(M=r.o(),M.c()){if(C=M.r1,A=M.r2,V=M.g1,x=M.g2,Q=M.b1,S=M.b2,f=1+A-C,u=1+x-V,e=1+S-Q,g=a.call(0,f,u,e),m=0,l=[],p=[],g==f)for(F=C,G=A,v="r",k=A+1,q=x+1,y=S+1,b=C;k>b;b++){for(w=0,h=V;q>h;h++)for(s=Q;y>s;s++)w+=i[1024*b+32*h+s]||0;m+=w,l[b]=m}else if(g==u)for(F=V,G=x,v="g",k=x+1,q=A+1,y=S+1,b=V;k>b;b++){for(w=0,h=C;q>h;h++)for(s=Q;y>s;s++)w+=i[32*b+1024*h+s]||0;m+=w,l[b]=m}else for(F=Q,G=S,v="b",k=S+1,q=A+1,y=x+1,b=Q;k>b;b++){for(w=0,h=C;q>h;h++)for(s=V;y>s;s++)w+=i[1024*h+32*s+b]||0;m+=w,l[b]=m}for(m/=2,d=l.length;d--;)l[d]&&(p[d]=m-l[d]);for(b=F;G>=b;b++)if(l[b]>m){for(z=b-F,j=G-b,E=z>j?a(F,~~(b-1-z/2)):c(G-1,~~(b+j/2));!l[E];)E++;for(o=p[E];!o&&l[E-1];)o=p[--E];B=new t(C,A,V,x,Q,S,M.h),B[v+"2"]=E,D=new t(C,A,V,x,Q,S,M.h),D[v+"1"]=E+1;break}if(r.u(B),D&&(r.u(D),H++),H>=n||I++>1e3)return}else r.u(M),I++}function e(r,e){i=[];for(var c,a,g,b,h=new f(o),s=32,v=0,l=32,p=0,m=32,w=0,M=new f(n),C=new f(o),A=r.length;A;)b=r[--A]>>3,g=r[--A]>>3,a=r[--A]>>3,s>a?s=a:a>v&&(v=a),l>g?l=g:g>p&&(p=g),m>b?m=b:b>w&&(w=b),c=1024*a+32*g+b,i[c]=(i[c]||0)+1;for(M.u(new t(s,v,l,p,m,w,i)),u(M,.75*e);M.s();)C.u(M.o());for(u(C,e-C.s());C.s();)h.u(C.o());return h.m(function(r){return r.a()})}var i,c=r.min,a=r.max;return t.prototype={v:function(){var r=this;return r.V||(r.V=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r.V},c:function(){var r=this;if(!r.S){for(var n,o,f,t,u=r.h,e=0,i=r.r1-1,c=r.r2+1;++i<c;)for(n=r.g1-1,o=r.g2+1;++n<o;)for(f=r.b1-1,t=r.b2+1;++f<t;)e+=u[1024*i+32*n+f]||0;r.C=e,r.S=1}return r.C},a:function(){var r=this,n=r.h;if(!r.A){for(var o,f,t,u,e,i=0,c=0,a=0,g=0,b=r.r1-1,h=r.r2+1;++b<h;)for(f=r.g1-1,t=r.g2+1;++f<t;)for(u=r.b1-1,e=r.b2+1;++u<e;)o=n[1024*b+32*f+u],o&&(i+=o,c+=o*(.5+b),a+=o*(.5+f),g+=o*(.5+u));r.A=i?[~~(8*c/i),~~(8*a/i),~~(8*g/i)]:[~~(4*(1+r.r1+r.r2)),~~(4*(1+r.g1+r.g2)),~~(4*(1+r.b1+r.b2))]}return r.A}},{quantize:e}}(Math);